# Required Pipeline Variables (Pipelines → Edit → Variables):
#   KOREKT_API_KEY - Your Korekt API key (set as secret)

trigger: none  # Only run on PRs, not direct pushes
pr: '*'

pool:
  vmImage: 'ubuntu-latest'

steps:
  - checkout: self
    fetchDepth: 0

  - script: |
      npm install -g korekt-cli
      TARGET_BRANCH=$(echo "$(System.PullRequest.TargetBranch)" | sed 's|refs/heads/||')
      kk review "origin/$TARGET_BRANCH" --comment --post-ticket
    env:
      KOREKT_API_KEY: $(KOREKT_API_KEY)
      SYSTEM_ACCESSTOKEN: $(System.AccessToken)
